# Weather App

Простое веб-приложение для получения прогноза погоды с использованием API Open-Meteo. Поддерживает автодополнение городов, историю поиска и статистику запросов.

## Реализованный функционал

- **Прогноз погоды**: Получение почасового прогноза на 24 часа для указанного города.
- **Автодополнение**: Подсказки городов при вводе с использованием Open-Meteo API (на русском языке).
- **История поиска**: Сохранение запросов каждого пользователя в базе данных SQLite.
- **Статистика**: API для подсчета количества поисков по городам.
- **Тесты**: Полный набор unit-тестов для проверки всех маршрутов и функционала.
- **Docker**: Приложение упаковано в Docker-контейнер для удобного развертывания.

## Технологии

- **FastAPI**: Веб-фреймворк для API и рендеринга страниц.
- **SQLite**: Легковесная база данных для хранения истории поиска.
- **Jinja2**: Шаблонизатор для рендеринга HTML.
- **HTTpx**: Асинхронный HTTP-клиент для внешних API.
- **Pytest**: Фреймворк для тестирования с моками (`responses`).
- **Docker**: Контейнеризация приложения.

## Требования

- Python 3.13 (для локального запуска)
- Docker (для запуска в контейнере)
- Зависимости указаны в `requirements.txt`

## Установка и запуск

### Локальный запуск

1. Клонируйте репозиторий:
   ```bash
   git clone <repository-url>
   cd test_task
   ```
2. Создайте виртуальное окружение и активируйте его:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Для Windows: venv\Scripts\activate
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Запустите приложение:

   ```bash
   uvicorn main:app --reload
   ```

   Приложение будет доступно по адресу `http://localhost:8000`.

5. Для запуска тестов:
   ```bash
   pytest test.py -v
   ```

### Запуск в Docker

1. Убедитесь, что Docker установлен и запущен.
2. Соберите Docker-образ:
   ```bash
   docker build -t weather-app .
   ```
3. Запустите контейнер:

   ```bash
   docker run -p 8000:8000 weather-app
   ```

   Приложение будет доступно по адресу `http://localhost:8000`.

4. Для запуска тестов в контейнере:
   ```bash
   docker run --rm weather-app pytest test.py -v
   ```

## Структура проекта

- `main.py`: Основное приложение FastAPI.
- `test.py`: Unit-тесты для всех маршрутов.
- `requirements.txt`: Зависимости проекта.
- `static/`: Статические файлы (CSS).
- `templates/`: HTML-шаблоны (Jinja2).
- `dockerfile`: Конфигурация Docker-контейнера.
- `.gitignore`: Исключение временных файлов (например, `weather.db`, `output.txt`).

## Использование

- Перейдите на `http://localhost:8000` для ввода города и просмотра прогноза.
- Используйте API:
  - `GET /autocomplete?query=<city>`: Автодополнение городов.
  - `POST /weather` с формой `city=<city>`: Прогноз погоды.
  - `GET /search-stats`: Статистика поисков.

## Примечания

- База данных SQLite (`weather.db`) создается автоматически при первом запуске.
- Тесты используют моки для Open-Meteo API, чтобы избежать внешних запросов.
